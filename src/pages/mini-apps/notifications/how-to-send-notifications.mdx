import { Link } from '@/components/Link'

# Send Notifications

Please take a minute to read the [Features & Guidelines](/mini-apps/notifications/features-and-guidelines).
It's important to follow these, otherwise we may disable your ability to send notifications.

To send notifications to users you need to:

-   Request permission in the Developer Portal Advanced settings, for your mini app,
-   request permission to send notifications from the user, via MiniKit (see [Request Permission](/mini-apps/commands/request-permission)),
-   actually send the notification using our API or the Developer Portal.

Notifications are queued on our servers, users may not receive them immediately.

## Manually sending notifications from Developer Portal

**Note: This form doesn't support localized notifications yet.
To take advantage of localizations, use the API.**

You can send notifications to multiple wallet addresses (up to a thousand) directly from the Developer Portal.

<div style={{ maxWidth: '50%' }}>
	![Notification Interface in the Developer Portal](/images/docs/mini-apps/commands/notifications-dev-portal.png)
</div>

Use the form to input addresses, and content details. Once you click the `Send` button and get a success response, your notifications will be queued for delivery.

## Send Notification API{{ tag: "POST", label: "https://developer.worldcoin.org/api/v2/minikit/send-notification" }}

This endpoint lets you send localized notifications to users of your mini app and requires an `api_key`.

### How do localizations work?

The user's language is available to you when they access your mini app
(via [Navigator](https://developer.mozilla.org/en-US/docs/Web/API/Navigator/language)).

All you need to do is provide localizations. Our backend will automatically infer which language is preferred by the user.
Currently we support only a subset of languages, with plans to expand. Find the entire list [here](/mini-apps/notifications/how-to-send-notifications#supported-languages).
You can only specify languages that we support.

-   If a user prefers a language that we don't currently support, we will deliver the notification in English.
-   If you don't specify a localization for the user's preferred language, the notification will not be delivered.
    The response will include a specific `reason` to inform you of this.

<Row>
    <Col>
        ### Body Params

        You are required to either specify both `title` and `message` OR `localisations`.

        <Properties>
            <Property name="wallet_addresses" type="string[]" required>
            The `wallet_addresses` is an array of wallet addresses to send the notification to. Users must have opted in to notifications for your app. Max 1000 users per call.
            </Property>
            <Property name="localisations" type="object[]">
            `localisations` is an array of objects with properties:
                - `language` (string, required): The language of the notification.
                - `title` (string, required): The localized title of the notification.
                - `message` (string, required): The localized message of the notification.
            It's required to provide at least the `en` language.
            </Property>
            <Property name="title" type="string" deprecated>
            Note: This will not localize your notifications. The `title` is the title of the notification. It should be 30 characters or less. May contain emojis.
            </Property>
            <Property name="message" type="string" deprecated>
            Note: This will not localize your notifications. The `message` is the message of the notification. It should be 200 characters or less. You can include the special variable `${username}` in your message, which will be replaced with the actual username of the recipient when the notification is delivered.
            </Property>
            <Property name="mini_app_path" type="string" required>
            The `mini_app_path` is the url encoded path of the mini app where your notification should link to when the user clicks on it. <br/><br/> Should be of the format `worldapp://mini-app?app_id=[app_id]&path=[path]` (path is optional).
            </Property>
            <Property name="app_id" type="string" required>
            The `app_id` is the identifier of the app initiating the transaction.
            </Property>
        </Properties>

        ### Request Headers
        <Properties>
            <Property name="Authorization" type="string" required={true}>
            The `Authorization` header should be the `api_key` for your app from the Developer Portal. Make sure to
            prefix it with `Bearer {api_key}`.
            </Property>
        </Properties>
    </Col>
    <Col>
        <CodeGroup title="Request" tag="POST" label="https://developer.worldcoin.org/api/v2/minikit/send-notification">
            ```bash {{ title: "cURL" }}
            curl -X POST "https://developer.worldcoin.org/api/v2/minikit/send-notification" \
                -H "Authorization: Bearer {api_key}" \
                -H "Content-Type: application/json" \
                -d '{"app_id": "app_id", "wallet_addresses": ["0x123", "0x456"], "localisations": [{"language": "en", "title": "title", "message": "Hello ${username}, your transaction is complete!"}], "mini_app_path": "mini_app_path"}'
            ```
            ```js
            fetch(apiUrl, {
                method: 'POST',
                headers: {
                    'Authorization': 'Bearer {api_key}',
                },
                body: JSON.stringify({
                    app_id: "app_id",
                    wallet_addresses: ["0x123", "0x456"],
                    localisations: [
                        {
                            language: "en",
                            title: "title",
                            message: "Hello ${username}, your transaction is complete!"
                        }
                    ],
                    mini_app_path: "mini_app_path"
                })
            })
            ```
        </CodeGroup>
    </Col>

</Row>
<hr/>
### Response
<Row>
    <Col>
        <Properties>
            <Property name="success" type="boolean">
            Indicates if the API request was successful.
            </Property>
            <Property name="status" type="number">
            The HTTP status code of the response.
            </Property>
            <Property name="result" type="array">
            An array of notification delivery results for each wallet address, where each item contains:
                - `walletAddress` (string): The wallet address that the notification was attempted to be sent to
                - `sent` (boolean): Whether the notification was successfully sent to this wallet address
                - `reason` (string, optional): If the notification failed to send, this field contains the reason
            </Property>
        </Properties>
    </Col>
    <Col>
        <CodeGroup title="Response">
            ```json
            {
                "success": true,
                "status": 200,
                "result": [
                    {
                        "walletAddress": "0x377da9cab87c04a1d6f19d8b4be9aef8df26fcdd",
                        "sent": true
                    },
                    {
                        "walletAddress": "0x444da9cab87c04a1d6f19d8b4be9aef8df26fcdd",
                        "sent": false,
                        "reason": "User has notification disabled for World App"
                    }
                ]
            }
            ```
        </CodeGroup>
    </Col>
</Row>
<hr/>

## Testing

We currently have a limit of 40 notifications per 4 hours for unverified apps. This is to help you test your notification implementations.
Currently you will need to create a new app if your app is verified as it will default to the verified app's metadata. In addition, you need
to enable notifications for your mini app inside of World App to receive them.

## Useful links

-   [Features & Guidelines](/mini-apps/notifications/guidelines)
-   [How To Request Notification Permissions](/mini-apps/commands/request-permission)
-   [How To Get Notification Permissions](/mini-apps/commands/get-permissions)

## Supported Languages

| Language                     | Code     |
| ---------------------------- | -------- |
| English                      | `en`     |
| Catalan                      | `ca`     |
| Chinese Simplified           | `zh_CN`  |
| French                       | `fr`     |
| German                       | `de`     |
| Hindi                        | `hi`     |
| Japanese                     | `ja`     |
| Korean                       | `ko`     |
| Polish                       | `pl`     |
| Portuguese                   | `pt`     |
| Spanish                      | `es`     |
| Spanish (Latin America)      | `es_419` |
| Malay                        | `ms`     |
| Thai                         | `th`     |
| Indonesian                   | `id`     |
| Traditional Chinese (Taiwan) | `zh_TW`  |
